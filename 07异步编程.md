éå¸¸å¥½ ğŸ‘
Dart çš„ **å¼‚æ­¥ç¼–ç¨‹ï¼ˆAsynchronous Programmingï¼‰** æ˜¯å­¦ä¹  Flutterã€æœåŠ¡ç«¯ Dartã€ç”šè‡³å¹¶å‘ç¼–ç¨‹çš„æ ¸å¿ƒä¹‹ä¸€ã€‚
å®ƒçš„è¯­æ³•è™½ç„¶ç®€æ´ï¼ˆä¸»è¦æ˜¯ `Future`ã€`async/await`ã€`Stream`ï¼‰ï¼Œ
ä½†è¦çœŸæ­£æŒæ¡ï¼Œä½ å¾—ç†è§£èƒŒåçš„æ‰§è¡Œæ¨¡å‹ã€äº‹ä»¶å¾ªç¯æœºåˆ¶ã€ä»¥åŠå®é™…å¼€å‘ä¸­çš„ç»å…¸ç”¨æ³•ã€‚

---

# ğŸš€ Dart å¼‚æ­¥ç¼–ç¨‹ä½¿ç”¨å¤§å…¨ï¼ˆå«æ ¸å¿ƒè¯­æ³• + æ¡ˆä¾‹ + å®æˆ˜ï¼‰

---

## ğŸ§© ä¸€ã€ä¸ºä»€ä¹ˆéœ€è¦å¼‚æ­¥ç¼–ç¨‹ï¼Ÿ

åœ¨ Dartï¼ˆåŒ…æ‹¬ Flutterï¼‰ä¸­ï¼Œ**æ‰€æœ‰ä»£ç é»˜è®¤æ˜¯å•çº¿ç¨‹æ‰§è¡Œçš„**ã€‚
å¦‚æœä½ æ‰§è¡Œä¸€ä¸ªè€—æ—¶æ“ä½œï¼ˆæ¯”å¦‚ç½‘ç»œè¯·æ±‚æˆ–æ–‡ä»¶IOï¼‰ï¼Œä¸»çº¿ç¨‹ä¼šè¢«é˜»å¡ï¼ŒUI ä¼šå¡ä½ã€‚

å¼‚æ­¥ç¼–ç¨‹çš„ç›®æ ‡æ˜¯ï¼š
ğŸ‘‰ â€œè®©ä»£ç **ä¸é˜»å¡ä¸»çº¿ç¨‹**ï¼Œä½†åˆèƒ½åœ¨ä»»åŠ¡å®Œæˆåæ‰§è¡Œå›è°ƒâ€ã€‚

---

## ğŸ§  äºŒã€å¼‚æ­¥çš„ä¸‰å¤§æ ¸å¿ƒï¼š`Future`ã€`async/await`ã€`Stream`

| æ¦‚å¿µ              | ä½œç”¨                 | ç±»ä¼¼äº                 |
| --------------- | ------------------ | ------------------- |
| **Future**      | è¡¨ç¤ºâ€œæœªæ¥ä¼šè¿”å›ä¸€ä¸ªç»“æœâ€çš„å¼‚æ­¥ä»»åŠ¡ | JS çš„ Promise        |
| **async/await** | ç®€åŒ– Future çš„å†™æ³•      | JS çš„ async/await    |
| **Stream**      | è¡¨ç¤ºä¸€ç³»åˆ—å¼‚æ­¥äº‹ä»¶ï¼ˆå¯ä»¥æŒç»­å¤šä¸ªå€¼ï¼‰ | JS çš„ Observableã€äº‹ä»¶æµ |

---

# ğŸ§® ä¸‰ã€Future çš„ä½¿ç”¨å¤§å…¨

---

## âœ… 1ï¸âƒ£ Future åŸºç¡€ç”¨æ³•

```dart
void main() {
  print('ä»»åŠ¡å¼€å§‹');

  Future(() {
    return 'å¼‚æ­¥ä»»åŠ¡ç»“æœ';
  }).then((value) {
    print('ä»»åŠ¡å®Œæˆï¼š$value');
  });

  print('ä¸»çº¿ç¨‹ç»§ç»­æ‰§è¡Œ');
}
```

è¾“å‡ºé¡ºåºï¼š

```
ä»»åŠ¡å¼€å§‹
ä¸»çº¿ç¨‹ç»§ç»­æ‰§è¡Œ
ä»»åŠ¡å®Œæˆï¼šå¼‚æ­¥ä»»åŠ¡ç»“æœ
```

> ğŸ’¡ `Future` è¡¨ç¤ºå»¶è¿Ÿæ‰§è¡Œçš„ä»»åŠ¡ã€‚
> å®ƒç«‹å³è¿”å›ä¸€ä¸ª Future å¯¹è±¡ï¼Œä»»åŠ¡å®Œæˆåä¼šè¿›å…¥å›è°ƒ `.then()`ã€‚

---

## âœ… 2ï¸âƒ£ Future.delayed â€”â€” æ¨¡æ‹Ÿè€—æ—¶ä»»åŠ¡

```dart
void main() {
  print('ä¸‹è½½å¼€å§‹');
  Future.delayed(Duration(seconds: 2), () {
    return 'å›¾ç‰‡ä¸‹è½½å®Œæˆ';
  }).then((value) {
    print(value);
  });
  print('ä¸»çº¿ç¨‹ç»§ç»­æ‰§è¡Œ');
}
```

è¾“å‡ºï¼š

```
ä¸‹è½½å¼€å§‹
ä¸»çº¿ç¨‹ç»§ç»­æ‰§è¡Œ
å›¾ç‰‡ä¸‹è½½å®Œæˆ
```

---

## âœ… 3ï¸âƒ£ æ•è·å¼‚å¸¸ï¼ˆcatchError / try-catchï¼‰

```dart
Future<int> fetchData() async {
  throw Exception('ç½‘ç»œé”™è¯¯');
}

void main() {
  fetchData().then((value) {
    print('ç»“æœï¼š$value');
  }).catchError((e) {
    print('å‡ºé”™äº†ï¼š$e');
  });
}
```

æˆ–è€…é…åˆ `async/await`ï¼š

```dart
void main() async {
  try {
    await fetchData();
  } catch (e) {
    print('æ•è·å¼‚å¸¸ï¼š$e');
  }
}
```

---

## âœ… 4ï¸âƒ£ å¤šä¸ª Future å¹¶è¡Œæ‰§è¡Œ

### ï¼ˆ1ï¼‰ç­‰å¾…æ‰€æœ‰ä»»åŠ¡å®Œæˆï¼š

```dart
void main() async {
  var results = await Future.wait([
    Future.delayed(Duration(seconds: 1), () => 'Aå®Œæˆ'),
    Future.delayed(Duration(seconds: 2), () => 'Bå®Œæˆ'),
    Future.delayed(Duration(seconds: 3), () => 'Cå®Œæˆ'),
  ]);

  print(results); // [Aå®Œæˆ, Bå®Œæˆ, Cå®Œæˆ]
}
```

### ï¼ˆ2ï¼‰è°å…ˆå®Œæˆè¿”å›è°ï¼š

```dart
void main() async {
  var result = await Future.any([
    Future.delayed(Duration(seconds: 3), () => 'ä»»åŠ¡1'),
    Future.delayed(Duration(seconds: 1), () => 'ä»»åŠ¡2'),
  ]);
  print(result); // è¾“å‡ºï¼šä»»åŠ¡2
}
```

---

# ğŸ§  å››ã€async / await å…¨è§£æ

---

## âœ… 1ï¸âƒ£ async å‡½æ•°çš„æœ¬è´¨

åŠ ä¸Š `async` å…³é”®å­—çš„å‡½æ•°ï¼Œä¼šè‡ªåŠ¨è¿”å›ä¸€ä¸ª `Future`ï¼š

```dart
Future<String> getData() async {
  return 'æ•°æ®å·²åŠ è½½';
}
```

ç­‰ä»·äºï¼š

```dart
Future<String> getData() {
  return Future(() => 'æ•°æ®å·²åŠ è½½');
}
```

---

## âœ… 2ï¸âƒ£ await ç­‰å¾… Future å®Œæˆ

```dart
Future<String> getUser() async {
  await Future.delayed(Duration(seconds: 2));
  return 'ç”¨æˆ·ä¿¡æ¯';
}

void main() async {
  print('å¼€å§‹è·å–');
  var user = await getUser();
  print(user);
  print('ç»“æŸ');
}
```

è¾“å‡ºï¼š

```
å¼€å§‹è·å–
ï¼ˆ2ç§’åï¼‰
ç”¨æˆ·ä¿¡æ¯
ç»“æŸ
```

---

## âœ… 3ï¸âƒ£ async / await çš„å¼‚å¸¸æ•è·

```dart
Future<String> fetchData() async {
  throw Exception('è¯·æ±‚å¤±è´¥');
}

void main() async {
  try {
    var data = await fetchData();
    print(data);
  } catch (e) {
    print('é”™è¯¯: $e');
  } finally {
    print('è¯·æ±‚ç»“æŸ');
  }
}
```

---

## âœ… 4ï¸âƒ£ async å‡½æ•°åµŒå¥—

```dart
Future<int> add(int a, int b) async {
  await Future.delayed(Duration(seconds: 1));
  return a + b;
}

Future<void> calculate() async {
  var result = await add(5, 3);
  print('ç»“æœ: $result');
}

void main() async {
  await calculate();
  print('è®¡ç®—ç»“æŸ');
}
```

---

# ğŸ” äº”ã€Streamï¼ˆå¼‚æ­¥æ•°æ®æµï¼‰

---

`Stream` ç”¨äºå¤„ç† **ä¸€ç³»åˆ—å¼‚æ­¥äº‹ä»¶**ï¼Œä¾‹å¦‚ WebSocketã€æ–‡ä»¶æµã€å®šæ—¶å™¨ã€ç”¨æˆ·è¾“å…¥ç­‰ã€‚

---

## âœ… 1ï¸âƒ£ Stream.periodic â€”â€” æ¯éš”ä¸€æ®µæ—¶é—´å‘é€äº‹ä»¶

```dart
void main() {
  Stream.periodic(Duration(seconds: 1), (count) => count)
      .take(5)
      .listen((value) {
    print('æ¥æ”¶ï¼š$value');
  }, onDone: () {
    print('æµç»“æŸ');
  });
}
```

è¾“å‡ºï¼š

```
æ¥æ”¶ï¼š0
æ¥æ”¶ï¼š1
æ¥æ”¶ï¼š2
æ¥æ”¶ï¼š3
æ¥æ”¶ï¼š4
æµç»“æŸ
```

---

## âœ… 2ï¸âƒ£ è‡ªå®šä¹‰ StreamController

```dart
import 'dart:async';

void main() {
  var controller = StreamController<String>();

  // è®¢é˜…ç›‘å¬
  controller.stream.listen((data) {
    print('æ”¶åˆ°: $data');
  }, onDone: () {
    print('æµç»“æŸ');
  });

  // å‘é€æ•°æ®
  controller.add('Hello');
  controller.add('World');
  controller.close();
}
```

---

## âœ… 3ï¸âƒ£ await for è¯»å–æµ

```dart
Stream<int> countStream(int to) async* {
  for (int i = 1; i <= to; i++) {
    await Future.delayed(Duration(seconds: 1));
    yield i; // å‘å¤–â€œå‘é€â€å€¼
  }
}

void main() async {
  await for (var value in countStream(3)) {
    print('æ”¶åˆ°ï¼š$value');
  }
  print('æµç»“æŸ');
}
```

---

# ğŸ’¡ å…­ã€ç»å…¸å®æˆ˜æ¡ˆä¾‹

---

## ğŸ“¦ æ¡ˆä¾‹1ï¼šæ¨¡æ‹Ÿä¸‹è½½æ–‡ä»¶è¿›åº¦

```dart
import 'dart:async';

Future<void> downloadFile() async {
  print('ä¸‹è½½å¼€å§‹...');
  for (int i = 1; i <= 100; i += 20) {
    await Future.delayed(Duration(milliseconds: 500));
    print('ä¸‹è½½è¿›åº¦ï¼š$i%');
  }
  print('ä¸‹è½½å®Œæˆï¼');
}

void main() async {
  await downloadFile();
}
```

---

## ğŸŒ æ¡ˆä¾‹2ï¼šå¹¶å‘è¯·æ±‚æ•°æ®

```dart
Future<String> fetchUser() async {
  await Future.delayed(Duration(seconds: 1));
  return 'User';
}

Future<String> fetchOrders() async {
  await Future.delayed(Duration(seconds: 2));
  return 'Orders';
}

void main() async {
  print('å¼€å§‹åŠ è½½');
  var results = await Future.wait([fetchUser(), fetchOrders()]);
  print('ç»“æœï¼š$results');
}
```

è¾“å‡ºï¼š

```
å¼€å§‹åŠ è½½
ç»“æœï¼š[User, Orders]
```

---

## ğŸ” æ¡ˆä¾‹3ï¼šä½¿ç”¨ Stream æ¨¡æ‹Ÿä¼ æ„Ÿå™¨æ•°æ®æµ

```dart
import 'dart:async';

Stream<double> sensorStream() async* {
  for (int i = 0; i < 5; i++) {
    await Future.delayed(Duration(seconds: 1));
    yield (20 + i * 0.5); // æ¨¡æ‹Ÿæ¸©åº¦å˜åŒ–
  }
}

void main() async {
  await for (var temp in sensorStream()) {
    print('å½“å‰æ¸©åº¦: $tempÂ°C');
  }
}
```

---

# ğŸ§­ ä¸ƒã€Dart å¼‚æ­¥ç¼–ç¨‹æ€»ç»“å›¾

| ç‰¹æ€§                 | ç±»ä¼¼ JS ä¸­çš„                | ç”¨é€”         |
| ------------------ | ----------------------- | ---------- |
| `Future`           | Promise                 | æ‰§è¡Œä¸€æ¬¡çš„å¼‚æ­¥ä»»åŠ¡  |
| `async/await`      | async/await             | è¯­æ³•ç³–ï¼Œç®€åŒ–å¼‚æ­¥ä»£ç  |
| `Stream`           | Observable/EventEmitter | å¤šæ¬¡å¼‚æ­¥äº‹ä»¶æµ    |
| `Future.wait()`    | Promise.all             | å¹¶å‘æ‰§è¡Œå¤šä¸ªä»»åŠ¡   |
| `StreamController` | EventEmitter            | æ‰‹åŠ¨ç®¡ç†äº‹ä»¶æµ    |
| `await for`        | for await...of          | è¿­ä»£ Stream  |

---

å¦‚æœä½ æ„¿æ„ï¼Œæˆ‘å¯ä»¥å¸®ä½ å†™ä¸€ä»½ **ã€ŒFlutter å¼‚æ­¥åº”ç”¨å®æˆ˜ç¯‡ã€**ï¼Œ
åŒ…æ‹¬ç½‘ç»œè¯·æ±‚ï¼ˆ`http`åŒ…ï¼‰ã€å›¾ç‰‡åŠ è½½è¿›åº¦æ¡ã€å¼‚æ­¥æ„å»º `FutureBuilder`ã€`StreamBuilder` çš„è¯¦ç»†è®²è§£ã€‚

æ˜¯å¦è¦æˆ‘å¸®ä½ å†™é‚£ä¸€éƒ¨åˆ†ï¼Ÿ
