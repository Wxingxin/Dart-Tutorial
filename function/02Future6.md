éå¸¸æ£’çš„é—®é¢˜ ğŸ’ªï¼
è¿™æ˜¯ç†è§£ Dart å¼‚æ­¥ç¼–ç¨‹ï¼ˆå°¤å…¶æ˜¯ `Future`ï¼‰ä¸­**é”™è¯¯å¤„ç†æœºåˆ¶**çš„å…³é”®ã€‚
æˆ‘ä»¬æ¥ä¸€æ­¥æ­¥è®²æ¸…æ¥š `async/await` çš„é”™è¯¯å¤„ç†æ–¹å¼ï¼Œä»¥åŠå®ƒä¸ `catchError` çš„åŒºåˆ«ï¼Œå¹¶ç»“åˆç»å…¸ä»£ç æ¡ˆä¾‹è®²è§£ã€‚

---

## ğŸ§© ä¸€ã€ä¸¤ç§ä¸»è¦çš„é”™è¯¯å¤„ç†æ–¹å¼

åœ¨ Dart ä¸­ï¼Œå¤„ç† `Future` é”™è¯¯æœ‰ä¸¤ç§æ–¹æ³•ï¼š

| æ–¹å¼                                | ç”¨æ³•                                    | é£æ ¼    | æ¨èåœºæ™¯          |
| --------------------------------- | ------------------------------------- | ----- | ------------- |
| â‘  `.catchError()`                 | `future.catchError((e) {...})`        | é“¾å¼è°ƒç”¨  | é€‚åˆå‡½æ•°å¼é£æ ¼ã€çŸ­é“¾å¼ä»»åŠ¡ |
| â‘¡ `try / catch`ï¼ˆé…åˆ `async/await`ï¼‰ | `try { await future } catch(e) {...}` | ç»“æ„åŒ–å†™æ³• | é€‚åˆå¤æ‚é€»è¾‘æˆ–å¤šæ­¥å¼‚æ­¥æ“ä½œ |

---

## ğŸ§  äºŒã€åŸºæœ¬ç¤ºä¾‹å¯¹æ¯”

### âœ… 1ï¸âƒ£ ä½¿ç”¨ `.catchError()`

```dart
Future<void> loadData() {
  return Future.delayed(Duration(seconds: 1), () {
    throw Exception('åŠ è½½å¤±è´¥');
  });
}

void main() {
  loadData().then((_) {
    print('åŠ è½½æˆåŠŸ');
  }).catchError((error) {
    print('æ•è·åˆ°é”™è¯¯ï¼š$error');
  }).whenComplete(() {
    print('æ— è®ºæˆåŠŸè¿˜æ˜¯å¤±è´¥éƒ½ä¼šæ‰§è¡Œ');
  });
}
```

ğŸ§© è¾“å‡ºï¼š

```
æ•è·åˆ°é”™è¯¯ï¼šException: åŠ è½½å¤±è´¥
æ— è®ºæˆåŠŸè¿˜æ˜¯å¤±è´¥éƒ½ä¼šæ‰§è¡Œ
```

ğŸ“˜ **è¯´æ˜**ï¼š

* `.catchError()` åªæ•è·ä¸Šä¸€ä¸ª `Future` æŠ›å‡ºçš„é”™è¯¯ï¼›
* `.whenComplete()` ç±»ä¼¼äº `finally`ï¼›
* é€‚åˆé“¾å¼é£æ ¼çš„ç¼–ç¨‹ã€‚

---

### âœ… 2ï¸âƒ£ ä½¿ç”¨ `async / await + try / catch`

```dart
Future<String> loadData() async {
  await Future.delayed(Duration(seconds: 1));
  throw Exception('åŠ è½½å¤±è´¥');
}

Future<void> main() async {
  try {
    final result = await loadData();
    print('åŠ è½½æˆåŠŸ: $result');
  } catch (e) {
    print('æ•è·åˆ°é”™è¯¯ï¼š$e');
  } finally {
    print('finallyï¼šä»»åŠ¡ç»“æŸ');
  }
}
```

ğŸ§© è¾“å‡ºï¼š

```
æ•è·åˆ°é”™è¯¯ï¼šException: åŠ è½½å¤±è´¥
finallyï¼šä»»åŠ¡ç»“æŸ
```

ğŸ“˜ **è¯´æ˜**ï¼š

* `try / catch` æ•è·çš„æ˜¯ `await` è¡¨è¾¾å¼å†…éƒ¨çš„å¼‚å¸¸ï¼›
* ä»£ç é€»è¾‘ç»“æ„åŒ–ï¼Œæ˜“è¯»ï¼›
* æ¨èç”¨äºå¤æ‚ä¸šåŠ¡é€»è¾‘ã€‚

---

## ğŸ§© ä¸‰ã€åŒºåˆ«æ€»ç»“è¡¨æ ¼

| å¯¹æ¯”é¡¹            | `.catchError()`     | `try / catch` (`async/await`) |
| -------------- | ------------------- | ----------------------------- |
| å†™æ³•             | é“¾å¼è°ƒç”¨                | ç»“æ„åŒ–ä»£ç                          |
| æ•è·ä½ç½®           | ä»…æ•è·ä¸Šä¸€ä¸ª Future çš„é”™è¯¯   | å¯æ•è·æ•´ä¸ª `await` å—ä¸­çš„é”™è¯¯           |
| å¯è¯»æ€§            | è¾ƒå·®ï¼Œé€‚åˆçŸ­é€»è¾‘            | æ¸…æ™°ã€ç›´è§‚                         |
| å¤šä¸ªå¼‚æ­¥ä»»åŠ¡         | ä¸å®¹æ˜“æ§åˆ¶               | å¯åœ¨åŒä¸€ä¸ª `try` ä¸­å¤„ç†å¤šä¸ªä»»åŠ¡           |
| æ˜¯å¦å¯ç”¨ `finally` | ç”¨ `.whenComplete()` | ç”¨ `finally`                   |
| æ¨èåœºæ™¯           | å•ä¸ªå¼‚æ­¥ä»»åŠ¡çš„é”™è¯¯å¤„ç†         | å¤šæ­¥å¼‚æ­¥é€»è¾‘ï¼ˆFlutter é¡µé¢ã€ä¸šåŠ¡é€»è¾‘ä¸­ï¼‰      |

---

## ğŸ§© å››ã€ç»å…¸å¯¹æ¯”æ¡ˆä¾‹ï¼šé“¾å¼ vs async/await

### ğŸ”¹ é“¾å¼ `.then().catchError()`

```dart
Future<String> fetchData() {
  return Future.delayed(Duration(seconds: 1), () => 'æ•°æ®åŠ è½½å®Œæ¯•');
}

void main() {
  fetchData()
      .then((value) {
        print('æˆåŠŸï¼š$value');
        throw Exception('å¤„ç†æ•°æ®æ—¶å‡ºé”™');
      })
      .catchError((e) {
        print('æ•è·åˆ°é”™è¯¯ï¼š$e');
      })
      .whenComplete(() => print('ä»»åŠ¡ç»“æŸ'));
}
```

ğŸ§© è¾“å‡ºï¼š

```
æˆåŠŸï¼šæ•°æ®åŠ è½½å®Œæ¯•
æ•è·åˆ°é”™è¯¯ï¼šException: å¤„ç†æ•°æ®æ—¶å‡ºé”™
ä»»åŠ¡ç»“æŸ
```

---

### ğŸ”¹ åŒæ ·é€»è¾‘ç”¨ `async / await`

```dart
Future<String> fetchData() async {
  await Future.delayed(Duration(seconds: 1));
  return 'æ•°æ®åŠ è½½å®Œæ¯•';
}

Future<void> main() async {
  try {
    final data = await fetchData();
    print('æˆåŠŸï¼š$data');
    throw Exception('å¤„ç†æ•°æ®æ—¶å‡ºé”™');
  } catch (e) {
    print('æ•è·åˆ°é”™è¯¯ï¼š$e');
  } finally {
    print('ä»»åŠ¡ç»“æŸ');
  }
}
```

ğŸ§© è¾“å‡ºï¼š

```
æˆåŠŸï¼šæ•°æ®åŠ è½½å®Œæ¯•
æ•è·åˆ°é”™è¯¯ï¼šException: å¤„ç†æ•°æ®æ—¶å‡ºé”™
ä»»åŠ¡ç»“æŸ
```

ğŸ” å¯ä»¥çœ‹åˆ°ï¼šåŠŸèƒ½ä¸€æ ·ï¼Œä½† `async/await` ç‰ˆæœ¬æ›´æ¸…æ™°ã€æ›´æ¥è¿‘åŒæ­¥é€»è¾‘ã€‚

---

## âš ï¸ äº”ã€å¸¸è§é™·é˜±ï¼š`catchError` ä¸èƒ½æ•è· `then` å†…éƒ¨çš„é”™è¯¯ï¼ˆé™¤éè®¾ç½®ï¼‰

çœ‹ä¸‹é¢çš„ä¾‹å­ğŸ‘‡

```dart
Future<void> main() async {
  Future(() => print('å¼€å§‹'))
      .then((_) {
        throw Exception('åœ¨ then ä¸­å‡ºé”™');
      })
      // âŒ ä¸ä¼šæ•è·åˆ° then å†…éƒ¨é”™è¯¯ï¼ˆé™¤éé…ç½® `test` å‚æ•°ï¼‰
      .catchError((e) => print('æ•è·é”™è¯¯ï¼š$e'));
}
```

ğŸ§© è¾“å‡ºï¼š

```
Unhandled exception: Exception: åœ¨ then ä¸­å‡ºé”™
```

ğŸ”§ è§£å†³æ–¹æ¡ˆï¼š

```dart
.catchError((e) => print('æ•è·é”™è¯¯ï¼š$e'), test: (_) => true);
```

æˆ–æ›´ç®€å•åœ°ç”¨ï¼š

```dart
try { await Future(...); } catch (e) {...}
```

---

## ğŸ§± å…­ã€å®æˆ˜ï¼šç½‘ç»œè¯·æ±‚ + é”™è¯¯å¤„ç†ï¼ˆFlutter å¸¸è§ï¼‰

```dart
Future<String> fetchUserData() async {
  // æ¨¡æ‹Ÿç½‘ç»œè¯·æ±‚
  await Future.delayed(Duration(seconds: 1));
  throw Exception('ç½‘ç»œè¯·æ±‚å¤±è´¥');
}

Future<void> main() async {
  try {
    final data = await fetchUserData();
    print('è·å–æ•°æ®æˆåŠŸï¼š$data');
  } on TimeoutException {
    print('è¯·æ±‚è¶…æ—¶');
  } on Exception catch (e) {
    print('æ•è·åˆ°æ™®é€šå¼‚å¸¸ï¼š$e');
  } catch (e) {
    print('æœªçŸ¥é”™è¯¯ï¼š$e');
  } finally {
    print('ç½‘ç»œè¯·æ±‚ç»“æŸ');
  }
}
```

ğŸ§© è¾“å‡ºï¼š

```
æ•è·åˆ°æ™®é€šå¼‚å¸¸ï¼šException: ç½‘ç»œè¯·æ±‚å¤±è´¥
ç½‘ç»œè¯·æ±‚ç»“æŸ
```

ğŸ“˜ **äº®ç‚¹ï¼š**

* å¯ä»¥ä½¿ç”¨å¤šä¸ª `on` å—åŒºåˆ†å¼‚å¸¸ç±»å‹ï¼›
* Flutter ä¸­ç½‘ç»œè¯·æ±‚ï¼ˆå¦‚ Dioã€httpï¼‰å¸¸ç”¨è¿™ç§å†™æ³•ï¼›
* æ¯” `.catchError()` æ›´å®¹æ˜“ç»´æŠ¤ã€‚

---

## ğŸ¯ ä¸ƒã€æ€»ç»“ä¸€å¥è¯

> ğŸ§© `.catchError()` ç”¨äº **é“¾å¼è°ƒç”¨é£æ ¼**ï¼Œçµæ´»ä½†å¯è¯»æ€§è¾ƒå·®ï¼›
> ğŸ§© `try / catch` ç”¨äº **async/await ç»“æ„åŒ–å†™æ³•**ï¼Œæ˜¯ç°ä»£ Dart/Flutter å¼€å‘ä¸­é¦–é€‰ã€‚

---

æ˜¯å¦å¸Œæœ›æˆ‘å¸®ä½ æ•´ç†ä¸€å¼ ã€Œ`Future` é”™è¯¯å¤„ç† + async/await + Stream é”™è¯¯æ•è·ã€çš„å®Œæ•´å›¾è°±ï¼Ÿ
å¯ä»¥ä¸€å¼ å›¾çœ‹æ¸… Dart å¼‚æ­¥é”™è¯¯æµå‘ã€‚
