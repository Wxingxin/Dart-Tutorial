非常好 👍
你现在要学的是 **Dart 的爬虫（Web Scraping）** —— 不依赖 Flutter UI，只用 **Dart 语言本身** 来抓取和解析网页内容。

我来教你最经典、最常用、最清晰的 Dart 爬虫案例（含详细注释和进阶扩展）。
本篇适合学习 Dart 网络编程 + 爬虫核心原理。

---

## 🕷️ 一、爬虫原理回顾

爬虫（Web Scraping）的三个步骤：

1️⃣ **发送 HTTP 请求** → 获取网页源代码。
2️⃣ **解析 HTML 内容** → 提取目标数据。
3️⃣ **存储结果** → 打印、保存文件或写入数据库。

在 Dart 里，我们可以使用：

* `http` 包 —— 发请求。
* `html` 包 —— 解析 HTML DOM。
* `dart:io` —— 写文件。

---

## 🧰 二、项目依赖

创建一个 Dart 项目：

```bash
dart create dart_spider_demo
cd dart_spider_demo
```

编辑 `pubspec.yaml`：

```yaml
dependencies:
  http: ^1.2.0
  html: ^0.15.5
```

执行：

```bash
dart pub get
```

---

## 💻 三、经典案例 1：爬取豆瓣电影 Top 250

保存为 `bin/douban_spider.dart`：

```dart
import 'package:http/http.dart' as http;
import 'package:html/parser.dart' as parser;
import 'package:html/dom.dart';

/// Dart 爬虫经典案例：爬取豆瓣电影 Top 250
/// 功能：
/// 1️⃣ 请求网页
/// 2️⃣ 提取电影标题和评分
/// 3️⃣ 打印结果

Future<void> main() async {
  print('开始爬取豆瓣电影 Top 250 ...');

  // 目标网址
  final url = Uri.parse('https://movie.douban.com/top250');

  // 添加 User-Agent 模拟浏览器请求
  final response = await http.get(url, headers: {
    'User-Agent':
        'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/108.0.0.0 Safari/537.36'
  });

  // 检查请求是否成功
  if (response.statusCode == 200) {
    // 解析 HTML 文本
    Document document = parser.parse(response.body);

    // 选择所有电影条目节点
    final movieItems = document.querySelectorAll('.item');

    for (var item in movieItems) {
      // 提取标题
      final title = item.querySelector('.title')?.text.trim() ?? '无标题';
      // 提取评分
      final rating = item.querySelector('.rating_num')?.text.trim() ?? '无评分';
      print('🎬 $title  ⭐ 评分：$rating');
    }
  } else {
    print('❌ 请求失败：${response.statusCode}');
  }

  print('✅ 爬取完成！');
}
```

---

### 🧠 代码讲解：

| 步骤 | 关键函数                                 | 作用                |
| -- | ------------------------------------ | ----------------- |
| 1  | `http.get()`                         | 向网页发送 GET 请求      |
| 2  | `parser.parse()`                     | 将 HTML 字符串转换为 DOM |
| 3  | `document.querySelectorAll('.item')` | 查找所有电影项           |
| 4  | `.querySelector('.title')?.text`     | 获取节点文本内容          |
| 5  | `print()`                            | 输出爬取结果            |

---

### ✅ 运行结果示例：

```bash
dart run bin/douban_spider.dart
```

输出：

```
开始爬取豆瓣电影 Top 250 ...
🎬 肖申克的救赎  ⭐ 评分：9.7
🎬 霸王别姬  ⭐ 评分：9.6
🎬 阿甘正传  ⭐ 评分：9.5
🎬 美丽人生  ⭐ 评分：9.5
...
✅ 爬取完成！
```

---

## 💾 四、案例 2：爬取并保存到本地文件

保存为 `bin/save_to_file.dart`：

```dart
import 'dart:io';
import 'package:http/http.dart' as http;
import 'package:html/parser.dart' as parser;

Future<void> main() async {
  print('正在爬取新闻数据...');

  final url = Uri.parse('https://news.ycombinator.com/');
  final response = await http.get(url);

  if (response.statusCode == 200) {
    final document = parser.parse(response.body);
    final titles = document.querySelectorAll('a.storylink, a.titlelink');

    final file = File('news.txt');
    final sink = file.openWrite();

    for (var i = 0; i < titles.length; i++) {
      final text = titles[i].text.trim();
      sink.writeln('📰 ${i + 1}. $text');
    }

    await sink.close();
    print('✅ 已保存到 news.txt');
  } else {
    print('❌ 请求失败：${response.statusCode}');
  }
}
```

运行：

```bash
dart run bin/save_to_file.dart
```

输出：

```
✅ 已保存到 news.txt
```

打开 `news.txt`：

```
📰 1. Google launches Dart 3.3
📰 2. Flutter 4.0 stable released
📰 3. AI startup raises $100M
...
```

---

## 🕸️ 五、案例 3：多页爬取（进阶）

```dart
import 'package:http/http.dart' as http;
import 'package:html/parser.dart' as parser;

Future<void> main() async {
  print('爬取豆瓣电影多页数据...');

  for (int page = 0; page < 3; page++) {
    final start = page * 25;
    final url = Uri.parse('https://movie.douban.com/top250?start=$start');
    final response = await http.get(url, headers: {
      'User-Agent': 'Mozilla/5.0 (compatible; DartSpider/1.0)'
    });

    if (response.statusCode == 200) {
      final document = parser.parse(response.body);
      final movies = document.querySelectorAll('.item');

      print('\n第 ${page + 1} 页：');
      for (var item in movies) {
        final title = item.querySelector('.title')?.text.trim() ?? '无标题';
        final rating = item.querySelector('.rating_num')?.text.trim() ?? '无评分';
        print('🎬 $title ⭐ $rating');
      }
    }
  }
}
```

运行结果：

```
第 1 页：
🎬 肖申克的救赎 ⭐ 9.7
🎬 霸王别姬 ⭐ 9.6
...

第 2 页：
🎬 这个杀手不太冷 ⭐ 9.4
🎬 泰坦尼克号 ⭐ 9.4
...
```

---

## ⚡ 六、拓展方向

| 目标     | 可用技术                          |
| ------ | ----------------------------- |
| 图片下载   | `HttpClient().getUrl()`       |
| 数据存储   | `Hive` / `MongoDB` / `SQLite` |
| 异步任务控制 | `Future.wait()` / `Stream`    |
| API 爬取 | `jsonDecode()` 解析 JSON        |
| 防反爬    | 自定义 Header / 随机 UA / 延迟请求     |

---

## 🧩 七、总结

| 模块                 | 作用     |
| ------------------ | ------ |
| `http`             | 发送请求   |
| `html`             | DOM 解析 |
| `dart:io`          | 文件操作   |
| `Future` / `await` | 异步执行   |
| `for` 循环 + DOM     | 遍历提取内容 |

---

是否希望我接着帮你写一个 **完整的 Dart 爬虫小项目** 👉
包含：

* 多页爬取
* 数据保存为 JSON
* 图片下载
* 并发请求优化

这个是 Dart 爬虫的实战综合版，非常经典。
要我帮你写这一版吗？
