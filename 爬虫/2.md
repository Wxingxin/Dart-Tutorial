在 Dart 中，爬虫的经典案例通常分为两大类：

1.  **静态页面爬取**：目标网站的内容是纯 HTML，加载时即存在。这是最经典、最简单的场景。
2.  **动态页面爬取 (JS 渲染)**：目标网站的内容依赖 JavaScript 在浏览器中执行后才生成（例如，使用 React, Vue, Angular 等框架的单页应用）。

下面我将为您提供这两种情况下的经典案例。

-----

### 案例一：静态页面爬取 (经典)

这是最常见的爬虫形式。我们将使用两个核心的 Dart 库：

  * `http`：用于发起网络请求，获取网页的 HTML 源代码。
  * `html`：用于解析 HTML 字符串，并像 JavaScript 中那样使用 CSS 选择器来查询元素。

**目标**：爬取 [Hacker News](https://news.ycombinator.com/) (一个对爬虫友好的静态网站) 的首页标题和链接。

#### 步骤 1: 设置项目

1.  创建一个新的 Dart 控制台项目：

    ```bash
    dart create dart_scraper
    cd dart_scraper
    ```

2.  在 `pubspec.yaml` 文件中添加依赖：

    ```yaml
    dependencies:
      http: ^1.0.0
      html: ^0.15.0
    ```

3.  安装依赖：

    ```bash
    dart pub get
    ```

#### 步骤 2: 编写爬虫代码

将以下代码放入 `bin/dart_scraper.dart`：

```dart
import 'package:http/http.dart' as http;
import 'package:html/parser.dart' as parser;

Future<void> main() async {
  // 1. 目标 URL
  final url = Uri.parse('https://news.ycombinator.com/');

  try {
    // 2. 发起 HTTP GET 请求
    final response = await http.get(url);

    // 3. 检查请求是否成功
    if (response.statusCode == 200) {
      // 4. 使用 'html' 包解析响应体 (HTML)
      final document = parser.parse(response.body);

      // 5. 使用 CSS 选择器查找所有标题元素
      //    在 Hacker News 中，标题的 class 是 'titleline'
      final elements = document.querySelectorAll('.titleline > a');

      print('Hacker News 首页标题:\n');

      // 6. 遍历元素并提取数据
      for (var element in elements) {
        // 提取标题文本
        final title = element.text;
        
        // 提取 'href' 属性 (链接)
        final link = element.attributes['href'];

        // 避免爬取到 "more" 这类非文章链接
        if (link != null && link.startsWith('http')) {
          print('标题: $title');
          print('链接: $link\n');
        }
      }
    } else {
      print('请求失败，状态码: ${response.statusCode}');
    }
  } catch (e) {
    print('发生错误: $e');
  }
}
```

#### 步骤 3: 运行

在您的终端中运行：

```bash
dart run
```

**输出示例：**

```
Hacker News 首页标题:

标题: Show HN: I built a 3D renderer in 1000 lines of C
链接: https://github.com/D-Programming-Language/dmd

标题: Why Lisp?
链接: http://www.paulgraham.com/whylisp.html

标题: Tesla faces investor lawsuit over Musk's alleged $7.5B 'self-dealing'
链接: https://techcrunch.com/2024/09/05/tesla-faces-investor-lawsuit-over-musks-alleged-7-5b-self-dealing/

...
```

-----

### 案例二：动态页面爬取 (现代)

当网站内容由 JavaScript 动态加载时，`http` 包只能获取到最原始的、不包含数据的 HTML 骨架。此时，我们需要一个“无头浏览器”(Headless Browser) 来模拟真实的用户浏览器，执行 JS 并渲染页面。

我们将使用 `puppeteer` 库，它是 Google Chrome 团队维护的 Node.js 库 Puppeteer 的 Dart 移植版。

**目标**：爬取 [quotes.toscrape.com/js](http://quotes.toscrape.com/js/) 上的名言。这个网站*专门*为爬虫演示而设计，它的名言是通过 JS 动态加载的。

#### 步骤 1: 设置项目

1.  创建一个新项目并添加依赖（如果您在上一个项目上继续，只需添加 `puppeteer`）：

    ```yaml
    dependencies:
      http: ^1.0.0
      html: ^0.15.0
      puppeteer: ^5.0.0 # 添加 puppeteer
    ```

2.  安装依赖：

    ```bash
    dart pub get
    ```

3.  **重要**：`puppeteer` 需要 Chromium 浏览器。第一次运行时，它会自动下载。

#### 步骤 2: 编写爬虫代码

```dart
import 'package:puppeteer/puppeteer.dart';

Future<void> main() async {
  // 1. 下载并启动一个浏览器实例
  //    (revision: 默认会指定一个测试过的 Chromium 版本)
  print('正在启动浏览器...');
  final browser = await puppeteer.launch(
    headless: true, // true 为无头模式，false 会打开一个浏览器窗口
    // slowMo: Duration(milliseconds: 50), // (可选) 减慢执行速度，便于观察
  );

  // 2. 打开一个新页面
  final page = await browser.newPage();

  // 3. 导航到目标 URL
  final url = 'http://quotes.toscrape.com/js/';
  print('正在导航到 $url');
  await page.goto(url, wait: Until.networkIdle); // 等待网络空闲，确保 JS 加载完毕

  // 4. (关键) 执行 JavaScript 来查询 DOM
  //    我们使用 page.evaluate() 在浏览器上下文中执行代码
  //    这就像在浏览器的控制台里运行 JS
  final quotes = await page.evaluate<List<Map<String, String>>>('''
    () => {
      // 在这里写的所有代码都是在浏览器中执行的 JS
      const quoteElements = document.querySelectorAll('.quote');
      const results = [];
      
      quoteElements.forEach((quote) => {
        const text = quote.querySelector('.text').innerText;
        const author = quote.querySelector('.author').innerText;
        results.push({ 'text': text, 'author': author });
      });
      
      return results;
    }
  ''');

  // 5. 关闭浏览器
  await browser.close();

  // 6. 打印在 Dart 中收到的结果
  print('\n爬取到的名言: \n');
  for (var quote in quotes) {
    print('名言: ${quote['text']}');
    print('作者: ${quote['author']}\n');
  }
}
```

#### 步骤 3: 运行

```bash
dart run
```

**输出示例：**
（第一次运行会先下载浏览器，请耐心等待）

```
正在启动浏览器...
正在导航到 http://quotes.toscrape.com/js/

爬取到的名言: 

名言: “The world as we have created it is a process of our thinking. It cannot be changed without changing our thinking.”
作者: Albert Einstein

名言: “It is our choices, Harry, that show what we truly are, far more than our abilities.”
作者: J.K. Rowling

...
```

### 总结对比

| 特性 | 案例一 (`http` + `html`) | 案例二 (`puppeteer`) |
| :--- | :--- | :--- |
| **适用场景** | 静态 HTML 网站 (如博客、新闻、论坛) | 动态 JS 渲染网站 (SPA, AJAX 加载) |
| **核心原理** | HTTP 请求 + HTML 文本解析 | 启动真实浏览器 + JS 执行 + DOM 查询 |
| **资源消耗** | 非常低 (轻量级) | 非常高 (需要运行一个完整的浏览器) |
| **执行速度** | 非常快 | 较慢 (需要等待页面渲染) |
| **复杂性** | 简单直接 | 较高，但功能强大 (可模拟点击、滚动、输入) |