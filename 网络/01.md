非常棒 👍 你已经学到 **Dart 网络编程** 这一核心能力部分了。
这在做 **后端服务（如 Dart + Shelf）** 或 **Flutter 实时通信** 时都非常有用。

我下面会用 **简单 + 经典的案例**，分别讲解 Dart 的
✅ TCP 服务端 / 客户端
✅ UDP 服务端 / 客户端
✅ HTTP 服务器与请求
✅ WebSocket

每个案例都能**独立运行**，只需保存为 `.dart` 文件后执行即可。

---

# 🧱 一、TCP 网络编程

Dart 中使用 `dart:io` 库来进行 TCP 通信。
它允许创建底层的 **Socket（套接字）** 连接，实现持久的点对点通信。

---

## 🖥️ TCP 服务端（Server）

```dart
// tcp_server.dart
import 'dart:io';

void main() async {
  // 启动一个 TCP 服务器
  final server = await ServerSocket.bind(InternetAddress.anyIPv4, 8080);
  print('✅ TCP 服务器已启动，监听端口: 8080');

  // 监听客户端连接
  await for (Socket client in server) {
    print('📡 客户端已连接: ${client.remoteAddress.address}:${client.remotePort}');

    // 监听客户端发来的消息
    client.listen((data) {
      final message = String.fromCharCodes(data);
      print('💬 收到客户端消息: $message');
      client.write('服务器已收到: $message');
    }, onDone: () {
      print('❌ 客户端断开连接');
      client.close();
    });
  }
}
```

---

## 💻 TCP 客户端（Client）

```dart
// tcp_client.dart
import 'dart:io';
import 'dart:convert';

void main() async {
  // 连接 TCP 服务器
  final socket = await Socket.connect('127.0.0.1', 8080);
  print('✅ 已连接服务器: ${socket.remoteAddress.address}:${socket.remotePort}');

  // 向服务器发送消息
  socket.write('Hello, Server!');

  // 监听服务器的回复
  socket.listen((data) {
    print('📩 收到服务器消息: ${utf8.decode(data)}');
  });

  // 延时关闭
  await Future.delayed(Duration(seconds: 3));
  socket.close();
}
```

运行步骤：

```bash
dart tcp_server.dart   # 先运行服务器
dart tcp_client.dart   # 再运行客户端
```

---

# 🛰️ 二、UDP 网络编程

UDP 是无连接的，速度快但不保证传输可靠。
非常适合做局域网广播、游戏同步、物联网消息。

---

## 🖥️ UDP 服务端

```dart
// udp_server.dart
import 'dart:io';
import 'dart:convert';

void main() async {
  final server = await RawDatagramSocket.bind(InternetAddress.anyIPv4, 8081);
  print('✅ UDP 服务器启动在端口 8081');

  server.listen((event) {
    if (event == RawSocketEvent.read) {
      final datagram = server.receive();
      if (datagram != null) {
        final message = utf8.decode(datagram.data);
        print('💬 收到: $message');
        server.send(utf8.encode('服务器已收到: $message'), datagram.address, datagram.port);
      }
    }
  });
}
```

---

## 💻 UDP 客户端

```dart
// udp_client.dart
import 'dart:io';
import 'dart:convert';

void main() async {
  final socket = await RawDatagramSocket.bind(InternetAddress.anyIPv4, 0);
  final serverAddress = InternetAddress('127.0.0.1');

  print('✅ UDP 客户端已启动');

  socket.send(utf8.encode('Hello UDP Server!'), serverAddress, 8081);

  socket.listen((event) {
    if (event == RawSocketEvent.read) {
      final datagram = socket.receive();
      if (datagram != null) {
        print('📩 收到服务器回复: ${utf8.decode(datagram.data)}');
      }
    }
  });
}
```

---

# 🌐 三、HTTP 服务器与请求

HTTP 是最常用的 Web 通信方式。

---

## 🖥️ HTTP 服务器

```dart
// http_server.dart
import 'dart:io';

void main() async {
  final server = await HttpServer.bind(InternetAddress.anyIPv4, 8082);
  print('✅ HTTP 服务器启动在 http://localhost:8082');

  await for (HttpRequest request in server) {
    print('📩 收到请求: ${request.method} ${request.uri.path}');

    // 返回响应
    request.response
      ..statusCode = 200
      ..headers.contentType = ContentType.html
      ..write('<h1>Hello from Dart HTTP Server!</h1>')
      ..close();
  }
}
```

---

## 💻 HTTP 客户端请求

```dart
// http_client.dart
import 'dart:io';

void main() async {
  final url = Uri.parse('http://localhost:8082');
  final client = HttpClient();

  final request = await client.getUrl(url);
  final response = await request.close();

  print('✅ 响应状态码: ${response.statusCode}');
  print('📄 响应内容:');
  await response.transform(SystemEncoding().decoder).forEach(print);
}
```

---

# 🔄 四、WebSocket 实时通信

WebSocket 支持双向实时通信，常用于聊天室、实时游戏、股票行情等。

---

## 🖥️ WebSocket 服务器

```dart
// websocket_server.dart
import 'dart:io';

void main() async {
  final server = await HttpServer.bind('localhost', 8083);
  print('✅ WebSocket 服务器启动在 ws://localhost:8083');

  await for (HttpRequest request in server) {
    if (WebSocketTransformer.isUpgradeRequest(request)) {
      final socket = await WebSocketTransformer.upgrade(request);
      print('📡 客户端连接成功');

      socket.listen((message) {
        print('💬 收到客户端消息: $message');
        socket.add('服务器回复: $message');
      }, onDone: () {
        print('❌ 客户端断开连接');
      });
    } else {
      request.response
        ..statusCode = HttpStatus.forbidden
        ..close();
    }
  }
}
```

---

## 💻 WebSocket 客户端

```dart
// websocket_client.dart
import 'dart:io';

void main() async {
  final socket = await WebSocket.connect('ws://localhost:8083');
  print('✅ 已连接 WebSocket 服务器');

  socket.add('Hello from Client!');

  socket.listen((message) {
    print('📩 收到服务器回复: $message');
  });

  await Future.delayed(Duration(seconds: 3));
  socket.close();
}
```

---

# 🧠 五、总结对比

| 类型            | 特点          | 使用场景         |
| ------------- | ----------- | ------------ |
| **TCP**       | 面向连接，可靠传输   | 聊天、文件传输      |
| **UDP**       | 无连接，速度快但不可靠 | 游戏、广播、实时传感数据 |
| **HTTP**      | 请求-响应模型     | 网页、API 接口    |
| **WebSocket** | 全双工实时通信     | 聊天室、实时推送     |

---

是否希望我接着帮你写一个
💬 **“基于 WebSocket 的实时聊天室 Demo（带 Flutter 前端 + Dart 服务端）”**？
这个案例非常经典，会帮你彻底掌握 Dart 异步 + 网络通信。
