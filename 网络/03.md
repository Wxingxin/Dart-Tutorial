非常好 👍
你已经从 Dart 基础、异步、网络编程学到真正的 **服务端实战阶段** 了！
我们这次就来做一个经典的、**简单但完整的「注册 + 登录」后端系统**，
使用 **纯 Dart + HttpServer + MongoDB**（当然也可以换成内存数据库）。

---

## 🎯 一、目标功能

✅ 用户注册
✅ 用户登录（验证用户名 + 密码）
✅ JSON 格式接口返回
✅ 使用 POST 请求
✅ 密码加密存储（MD5 / bcrypt）
✅ 可接入 Flutter / Web 前端

---

## 🧱 二、项目结构

```
dart_auth_server/
 ├── pubspec.yaml
 └── bin/
     └── server.dart
```

---

## 📦 三、依赖配置

在 `pubspec.yaml` 中添加依赖：

```yaml
name: dart_auth_server
description: Simple Dart auth server
environment:
  sdk: '>=3.0.0 <4.0.0'

dependencies:
  mongo_dart: ^0.10.3
  crypto: ^3.0.3
```

然后运行：

```bash
dart pub get
```

---

## 💻 四、服务端完整代码（含详细注释）

保存为：`bin/server.dart`

```dart
import 'dart:io';
import 'dart:convert';
import 'package:mongo_dart/mongo_dart.dart';
import 'package:crypto/crypto.dart';

/// ✅ 启动命令：dart run bin/server.dart
///
/// 简易注册 & 登录系统
/// 功能：
/// 1️⃣ 注册：POST /register { "username": "xx", "password": "123" }
/// 2️⃣ 登录：POST /login { "username": "xx", "password": "123" }

void main() async {
  // 连接 MongoDB 数据库
  final db = await Db.create("mongodb://localhost:27017/dart_auth");
  await db.open();
  final users = db.collection("users");

  // 启动 HTTP 服务器
  final server = await HttpServer.bind(InternetAddress.anyIPv4, 8080);
  print('🚀 Dart Auth Server 运行中：http://localhost:8080');

  // 监听请求
  await for (HttpRequest request in server) {
    // 允许跨域（方便前端请求）
    request.response.headers.add("Access-Control-Allow-Origin", "*");
    request.response.headers.add("Access-Control-Allow-Headers", "Content-Type");

    if (request.method == "OPTIONS") {
      request.response
        ..statusCode = 200
        ..close();
      continue;
    }

    // 路由处理
    if (request.uri.path == '/register' && request.method == 'POST') {
      await handleRegister(request, users);
    } else if (request.uri.path == '/login' && request.method == 'POST') {
      await handleLogin(request, users);
    } else {
      // 未知路径
      request.response
        ..statusCode = 404
        ..write(jsonEncode({'error': 'Not Found'}))
        ..close();
    }
  }
}

/// 用户注册
Future<void> handleRegister(HttpRequest request, DbCollection users) async {
  try {
    final body = await utf8.decoder.bind(request).join();
    final data = jsonDecode(body);

    final username = data['username'];
    final password = data['password'];

    if (username == null || password == null) {
      throw Exception("缺少字段");
    }

    // 检查是否存在
    final exists = await users.findOne({'username': username});
    if (exists != null) {
      request.response
        ..statusCode = 400
        ..write(jsonEncode({'error': '用户名已存在'}))
        ..close();
      return;
    }

    // 使用 MD5 加密密码（可换 bcrypt）
    final hashed = md5.convert(utf8.encode(password)).toString();

    await users.insertOne({'username': username, 'password': hashed});
    request.response
      ..statusCode = 200
      ..write(jsonEncode({'message': '注册成功'}))
      ..close();
  } catch (e) {
    request.response
      ..statusCode = 400
      ..write(jsonEncode({'error': e.toString()}))
      ..close();
  }
}

/// 用户登录
Future<void> handleLogin(HttpRequest request, DbCollection users) async {
  try {
    final body = await utf8.decoder.bind(request).join();
    final data = jsonDecode(body);

    final username = data['username'];
    final password = data['password'];

    if (username == null || password == null) {
      throw Exception("缺少字段");
    }

    final user = await users.findOne({'username': username});
    if (user == null) {
      request.response
        ..statusCode = 404
        ..write(jsonEncode({'error': '用户不存在'}))
        ..close();
      return;
    }

    final hashed = md5.convert(utf8.encode(password)).toString();

    if (user['password'] == hashed) {
      request.response
        ..statusCode = 200
        ..write(jsonEncode({'message': '登录成功'}))
        ..close();
    } else {
      request.response
        ..statusCode = 401
        ..write(jsonEncode({'error': '密码错误'}))
        ..close();
    }
  } catch (e) {
    request.response
      ..statusCode = 400
      ..write(jsonEncode({'error': e.toString()}))
      ..close();
  }
}
```

---

## 🧠 五、运行与测试

### 1️⃣ 启动 MongoDB

```bash
mongod --dbpath <你的数据库路径>
```

### 2️⃣ 启动 Dart 服务端

```bash
dart run bin/server.dart
```

输出：

```
🚀 Dart Auth Server 运行中：http://localhost:8080
```

---

### 3️⃣ 使用 Postman / curl 测试接口

#### 注册接口：

```
POST http://localhost:8080/register
Content-Type: application/json

{
  "username": "alice",
  "password": "123456"
}
```

返回：

```json
{"message": "注册成功"}
```

#### 登录接口：

```
POST http://localhost:8080/login
Content-Type: application/json

{
  "username": "alice",
  "password": "123456"
}
```

返回：

```json
{"message": "登录成功"}
```

---

## 🔒 六、进阶方向（可选）

| 功能           | 说明                             |
| ------------ | ------------------------------ |
| ✅ bcrypt 加密  | 使用 `package:bcrypt` 替代 md5，更安全 |
| ✅ JWT 令牌     | 注册后发放登录 Token                  |
| ✅ 用户信息接口     | `/profile` 返回当前用户资料            |
| ✅ Flutter 前端 | 直接使用 `http.post()` 与此接口交互      |
| ✅ 异步流式写法     | 优化 IO 性能                       |

---

是否希望我接着帮你写一个对应的
**Flutter 前端（注册 + 登录页面 + 与 Dart 服务端交互）** 示例？
这样你就可以直接从手机或网页界面注册、登录了。
